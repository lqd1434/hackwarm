{"remainingRequest":"/Users/lqd/WebstormProjects/warm/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lqd/WebstormProjects/warm/src/components/Main.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lqd/WebstormProjects/warm/src/components/Main.vue","mtime":1618735501399},{"path":"/Users/lqd/WebstormProjects/warm/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lqd/WebstormProjects/warm/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/lqd/WebstormProjects/warm/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lqd/WebstormProjects/warm/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7Y3JlYXRlTmFtZXNwYWNlZEhlbHBlcnN9IGZyb20gJ3Z1ZXgnCgpjb25zdCB7IG1hcE11dGF0aW9ucywgbWFwQWN0aW9ucyxtYXBTdGF0ZSB9ID0gY3JlYXRlTmFtZXNwYWNlZEhlbHBlcnMoJ3dhcm0nKQpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ01haW4nLAogIGNvbXB1dGVkOnsKICAgIC4uLm1hcFN0YXRlKFsnaXNTaG93Rm9vdGVyTWVudScsJ3VzZXInLCdzb2NrZXQnLCd0YWxrVG9XaG8nLCdtYXhJZCddKQogIH0sCiAgbW91bnRlZCAoKSB7CiAgICB0aGlzLm9wZW5Tb2NrZXQoKQogICAgdGhpcy4kcm91dGVyLnB1c2goJy9ob21lJykKICB9LAogIG1ldGhvZHM6ewogICAgLi4ubWFwTXV0YXRpb25zKFsndGVzdCcsJ3NldFNvY2tldCcsJ2Nsb3NlU29ja2V0Jywnc2V0Q2hhdExpc3QnLCdhZGRNZXNzYWdlSGlzdG9yeScsJ2luY3JlYXNlTWF4SWQnXSksCiAgICAuLi5tYXBBY3Rpb25zKFsnYWRkQ2hhdExpc3RBY3Rpb24nLCdnZXRDaGF0TGlzdEFjdGlvbiddKSwKICAgIGRvVGVzdCgpewogICAgICB0aGlzLnRlc3QoJ+WTiOWTiCcpCiAgICAgIHRoaXMudGVzdEFjdGlvbignaGgnKQogICAgfSwKICAgIGFuaW1hdGUgKGRhdGEpewogICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGF0YSkKICAgICAgZWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gJ3RyYW5zZm9ybSAxNTBtcyBsaW5lYXInCiAgICAgIGVsZW1lbnQuc3R5bGUudHJhbnNmb3JtT3JpZ2luPSc1MCUgMCUnCiAgICAgIGVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgyMGRlZyknCiAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoLTIwZGVnKScKICAgICAgfSwxNTApCiAgICAgIHNldFRpbWVvdXQoKCk9PnsKICAgICAgICBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoMGRlZyknCiAgICAgIH0sMzAwKQogICAgfSwKICAgIG9wZW5Tb2NrZXQgKCkgewogICAgICBpZiAodHlwZW9mIChXZWJTb2NrZXQpID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGNvbnNvbGUubG9nKCfmgqjnmoTmtY/op4jlmajkuI3mlK/mjIFXZWJTb2NrZXQnKQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUubG9nKCfmgqjnmoTmtY/op4jlmajmlK/mjIFXZWJTb2NrZXQnKQogICAgICAgIGxldCBzb2NrZXRVcmwgPSAnd3M6Ly8xODIuMjU0LjE1OS4zNzo4MDgxL3dzLycgKyB0aGlzLnVzZXIuaWQKICAgICAgICAvLyBzb2NrZXRVcmwgPSBzb2NrZXRVcmwucmVwbGFjZSgnaHR0cHMnLCAnd3MnKS5yZXBsYWNlKCdodHRwJywgJ3dzJykKICAgICAgICB0aGlzLnNldFNvY2tldChuZXcgV2ViU29ja2V0KHNvY2tldFVybCkpCiAgICAgICAgLy8g5omT5byA5LqL5Lu2CiAgICAgICAgdGhpcy5zb2NrZXQub25vcGVuID0gKCkgPT4gewogICAgICAgICAgdGhpcy4kdG9hc3QoewogICAgICAgICAgICBtZXNzYWdlOiAnd2Vic29ja2V05bey5omT5byAJywKICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgICAvLyDojrflvpfmtojmga/kuovku7YKICAgICAgICB0aGlzLnNvY2tldC5vbm1lc3NhZ2UgPSAobXNnKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhtc2cuZGF0YSkKICAgICAgICAgIGNvbnN0IGluZGV4PW1zZy5kYXRhLmluZGV4T2YoJzonKQogICAgICAgICAgY29uc29sZS5sb2coaW5kZXgpCiAgICAgICAgICBjb25zdCBkYXRlMSA9IChuZXcgRGF0ZSgpLnRvTG9jYWxlRGF0ZVN0cmluZygpKS5yZXBsYWNlKC9cLy9nLCAnLScpCiAgICAgICAgICBjb25zdCB0aW1lMSA9IChuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpKS5zbGljZSgyKQogICAgICAgICAgY29uc3QgZGF0ZSA9IGRhdGUxICsgJyDml7bpl7QgJyArIHRpbWUxCiAgICAgICAgICBjb25zdCBtZXNzYWdlPXtmcm9tSWQ6cGFyc2VJbnQobXNnLmRhdGEuc2xpY2UoMCxpbmRleCkpLExhc3RNc2c6bXNnLmRhdGEuc2xpY2UoaW5kZXgrMSksQ3JlYXRlZEF0OmRhdGV9CiAgICAgICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKQogICAgICAgICAgdGhpcy5hZGRDaGF0TGlzdEFjdGlvbihtZXNzYWdlKQogICAgICAgICAgdGhpcy5nZXRDaGF0TGlzdEFjdGlvbigpCiAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLm1heElkKzEpCiAgICAgICAgICB0aGlzLmluY3JlYXNlTWF4SWQoKQogICAgICAgICAgY29uc3QgbWVzc2FnZTIgPSB7CiAgICAgICAgICAgIGlkOiB0aGlzLm1heElkKzEsCiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IGRhdGUsCiAgICAgICAgICAgIGZyb206IG1lc3NhZ2UuZnJvbUlkLAogICAgICAgICAgICB0bzogdGhpcy51c2VyLmlkLAogICAgICAgICAgICBtc2c6IG1lc3NhZ2UuTGFzdE1zZwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5hZGRNZXNzYWdlSGlzdG9yeShtZXNzYWdlMikKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7dHlwZTogJ3N1Y2Nlc3MnLCBtZXNzYWdlOiBtZXNzYWdlLkxhc3RNc2d9KQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyDlj5HnlJ/kuobplJnor6/kuovku7YKICAgICAgICB0aGlzLnNvY2tldC5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgY29uc29sZS5sb2coJ3dlYnNvY2tldOWPkeeUn+S6humUmeivrycpCiAgICAgICAgfQogICAgICB9CiAgICB9LAogIGJlZm9yZURlc3Ryb3kgKCkgewogICAgdGhpcy5jbG9zZVNvY2tldCgpCiAgICBsb2NhbFN0b3JhZ2UuY2xlYXIoKQogIH0KfQo="},{"version":3,"sources":["Main.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAcA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Main.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div>\n      <router-view></router-view>\n      <div class=\"footer-tabbar\" v-if=\"this.isShowFooterMenu\">\n        <van-tabbar route style=\"overflow: hidden\">\n          <van-tabbar-item replace to=\"/home\" icon=\"bi bi-house-door-fill\" :id=\"'1'\" @click=\"animate('1')\">树洞</van-tabbar-item>\n          <van-tabbar-item replace to=\"/talkList\" icon=\"bi bi-chat-dots-fill\" :id=\"'2'\" @click=\"animate('2')\">消息</van-tabbar-item>\n          <van-tabbar-item replace to=\"/mine\" icon=\"bi bi-person-circle\" :id=\"'3'\" @click=\"animate('3')\">我的</van-tabbar-item>\n        </van-tabbar>\n      </div>\n    </div>\n</template>\n\n<script>\nimport {createNamespacedHelpers} from 'vuex'\n\nconst { mapMutations, mapActions,mapState } = createNamespacedHelpers('warm')\nexport default {\n  name: 'Main',\n  computed:{\n    ...mapState(['isShowFooterMenu','user','socket','talkToWho','maxId'])\n  },\n  mounted () {\n    this.openSocket()\n    this.$router.push('/home')\n  },\n  methods:{\n    ...mapMutations(['test','setSocket','closeSocket','setChatList','addMessageHistory','increaseMaxId']),\n    ...mapActions(['addChatListAction','getChatListAction']),\n    doTest(){\n      this.test('哈哈')\n      this.testAction('hh')\n    },\n    animate (data){\n      const element = document.getElementById(data)\n      element.style.transition = 'transform 150ms linear'\n      element.style.transformOrigin='50% 0%'\n      element.style.transform = 'rotate(20deg)'\n      setTimeout(()=>{\n        element.style.transform = 'rotate(-20deg)'\n      },150)\n      setTimeout(()=>{\n        element.style.transform = 'rotate(0deg)'\n      },300)\n    },\n    openSocket () {\n      if (typeof (WebSocket) === 'undefined') {\n        console.log('您的浏览器不支持WebSocket')\n      } else {\n        console.log('您的浏览器支持WebSocket')\n        let socketUrl = 'ws://182.254.159.37:8081/ws/' + this.user.id\n        // socketUrl = socketUrl.replace('https', 'ws').replace('http', 'ws')\n        this.setSocket(new WebSocket(socketUrl))\n        // 打开事件\n        this.socket.onopen = () => {\n          this.$toast({\n            message: 'websocket已打开',\n            type: 'success'\n          })\n        }\n        // 获得消息事件\n        this.socket.onmessage = (msg) => {\n          console.log(msg.data)\n          const index=msg.data.indexOf(':')\n          console.log(index)\n          const date1 = (new Date().toLocaleDateString()).replace(/\\//g, '-')\n          const time1 = (new Date().toLocaleTimeString()).slice(2)\n          const date = date1 + ' 时间 ' + time1\n          const message={fromId:parseInt(msg.data.slice(0,index)),LastMsg:msg.data.slice(index+1),CreatedAt:date}\n          console.log(message)\n          this.addChatListAction(message)\n          this.getChatListAction()\n          console.log(this.maxId+1)\n          this.increaseMaxId()\n          const message2 = {\n            id: this.maxId+1,\n            created_at: date,\n            from: message.fromId,\n            to: this.user.id,\n            msg: message.LastMsg\n          }\n          this.addMessageHistory(message2)\n          this.$notify({type: 'success', message: message.LastMsg})\n          }\n        }\n        // 发生了错误事件\n        this.socket.onerror = function () {\n          console.log('websocket发生了错误')\n        }\n      }\n    },\n  beforeDestroy () {\n    this.closeSocket()\n    localStorage.clear()\n  }\n}\n</script>\n\n<style scoped>\n.footer-tabbar .van-tabbar-item {\n   border-top: #E2E2E2 1px solid;\n }\n\n.footer-tabbar{\n  display: block;\n  background-color: lightsteelblue!important;\n}\n</style>\n"]}]}